{"version":3,"sources":["main.js"],"names":["SceneType","cc","Enum","INDEX","FORM","JOIN","CHOOSE","PUZZLE","SUCCEED","Scene","Class","name","properties","type","default","node","Node","extends","Component","ctor","_duration","_sceneIndex","_id","_video","_isPlay","scenes","btnPass","btnSubmit","btnJoin","btnAgain","btnGet","puzzle","video","Sprite","inputUsername","EditBox","inputMoblie","onLoad","manager","director","getCollisionManager","enabled","getComponent","on","EventType","TOUCH_END","handleSubmit","handleJoin","handleAgain","handleGet","handlePass","evt","log","detail","puzzleSucceed","updateBlock","index","nextScene","initVideo","start","update","dt","getVideoFrame","document","getElementById","play","addEventListener","aniBtn","window","WeixinJSBridge","invoke","width","height","canvas","createElement","Number","ctx","getContext","drawImage","img","Image","src","toDataURL","onload","texture","Texture2D","initWithElement","handleLoadedTexture","spriteFrame","SpriteFrame","pause","req","username","string","mobile","alert","test","sendRequest","path","method","data","phone","then","id","error","prevScene","location","href","status","value","map","obj","active","btn","action","repeatForever","sequence","scaleTo","runAction","extraUrl","Promise","resolve","reject","xhr","loader","getXMLHttpRequest","requestURL","params","Object","keys","key","encodeURIComponent","join","timeout","sys","isNative","setRequestHeader","open","responseText","length","JSON","parse","statusText","onerror","send"],"mappings":"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","file":"main.js","sourceRoot":"../../../../assets/script","sourcesContent":["// 场景\nconst SceneType = cc.Enum({\n    INDEX: 0,\n    FORM: 1,\n    JOIN: 2,\n    CHOOSE: 3,\n    PUZZLE: 4,\n    SUCCEED: 5\n});\n\nconst Scene = cc.Class({\n    name: 'Scene',\n    properties: {\n        type: {\n            default: SceneType.INDEX,\n            type: SceneType\n        },\n        node: cc.Node\n    }\n});\n\ncc.Class({\n    extends: cc.Component,\n\n    ctor() {\n        // 动画时间\n        this._duration = .3;\n        // 场景索引值\n        this._sceneIndex = 0;\n        // 用户ID\n        this._id = null;\n        // 视频\n        this._video = null;\n        // 是否播放\n        this._isPlay = false;\n    },\n\n    properties: {\n        scenes: {\n            default: [],\n            type: Scene\n        },\n        btnPass: {\n            default: null,\n            type: cc.Node\n        },\n        btnSubmit: {\n            default: null,\n            type: cc.Node\n        },\n        btnJoin: {\n            default: null,\n            type: cc.Node\n        },\n        btnAgain: {\n            default: null,\n            type: cc.Node\n        },\n        btnGet: {\n            default: null,\n            type: cc.Node\n        },\n        puzzle: {\n            default: null,\n            type: cc.Node\n        },\n        video: {\n            default: null,\n            type: cc.Sprite\n        },\n        inputUsername: {\n            default: null,\n            type: cc.EditBox\n        },\n        inputMoblie: {\n            default: null,\n            type: cc.EditBox\n        }\n    },\n\n    onLoad() {\n        // 开启碰撞\n        const manager = cc.director.getCollisionManager();\n        manager.enabled = true;\n\n        // 初始化组件\n        this.puzzle = this.puzzle.getComponent('puzzle');\n\n        // 定义事件\n        this.btnSubmit.on(cc.Node.EventType.TOUCH_END, this.handleSubmit, this);\n\n        this.btnJoin.on(cc.Node.EventType.TOUCH_END, this.handleJoin, this);\n\n        this.btnAgain.on(cc.Node.EventType.TOUCH_END, this.handleAgain, this);\n\n        this.btnGet.on(cc.Node.EventType.TOUCH_END, this.handleGet, this);\n\n        this.btnPass.on(cc.Node.EventType.TOUCH_END, this.handlePass, this);\n\n        this.node.on('nextScene', (evt) => {\n            cc.log(evt.detail);\n\n            this.puzzleSucceed();\n        });\n\n        this.node.on('choosePuzzle', (evt) => {\n            cc.log(evt.detail);\n\n            this.puzzle.updateBlock(evt.detail.index);\n\n            this.nextScene();\n        });\n\n        this.initVideo();\n    },\n\n    start() {},\n\n    update(dt) {\n        if (this._isPlay && this._video) {\n            this.getVideoFrame();\n        }\n    },\n\n    // 初始化视频\n    initVideo() {\n        const video = document.getElementById('video');\n\n        this._video = video;\n\n        this.video.node.on(cc.Node.EventType.TOUCH_END, () => {\n            if (!this._isPlay) {\n                video.play();\n            }\n        }, this);\n\n        video.addEventListener('play', () => {\n            this._isPlay = true;\n        }, false);\n\n        video.addEventListener('ended', () => {\n            this._isPlay = false;\n\n            this.aniBtn('btnPass');\n        }, false);\n\n        if (window.WeixinJSBridge) {\n            WeixinJSBridge.invoke('getNetworkType', {}, () => {\n                video.play();\n            }, false);\n        } else {\n            document.addEventListener('WeixinJSBridgeReady', () => {\n                WeixinJSBridge.invoke('getNetworkType', {}, () => {\n                    video.play();\n                });\n            }, false);\n        }\n    },\n\n    // 获取视频图片帧\n    getVideoFrame() {\n        const width = video.width;\n        const height = video.height;\n\n        const canvas = document.createElement('canvas');\n        canvas.width = Number(width);\n        canvas.height = Number(height);\n\n        const ctx = canvas.getContext('2d');\n        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n \n        const img = new Image();\n        img.src = canvas.toDataURL('image/jpeg');\n        img.onload = () => {\n            const texture = new cc.Texture2D();\n            texture.initWithElement(img);\n            texture.handleLoadedTexture();\n\n            const spriteFrame = new cc.SpriteFrame(texture);\n\n            this.video.spriteFrame = spriteFrame;\n        }\n    },\n\n    // 跳过视频\n    handlePass(evt) {\n        this._isPlay = false;\n        this._video.pause();\n\n        this.nextScene();\n    },\n\n    // 提交表单\n    handleSubmit() {\n        const req = /^(13[0-9]|14[5-9]|15[012356789]|166|17[0-8]|18[0-9]|19[8-9])[0-9]{8}$/;\n        const username = this.inputUsername.string;\n        const mobile = this.inputMoblie.string;\n\n        if (username === '') {\n            alert('请输入您的姓名');\n\n            return;\n        }\n\n        if (mobile === '') {\n            alert('请输入您的手机号码');\n\n            return;\n        } else if (!req.test(Number(mobile))) {\n            alert('请输入有效的手机号码');\n\n            return;\n        }\n\n        this.sendRequest({\n            path: 'recode_user.php',\n            method: 'POST',\n            data: {\n                name: username,\n                phone: mobile\n            }\n        }).then((data) => {\n            this._id = data.id;\n\n            this.nextScene();\n        }, (error) => {\n            alert(error);\n        });\n    },\n\n    // 加入互动\n    handleJoin() {\n        cc.log('加入互动');\n\n        this.nextScene();\n    },\n\n    // 再次挑战\n    handleAgain() {\n        cc.log('再次挑战');\n\n        this.prevScene();\n    },\n\n    // 获取权益\n    handleGet() {\n        location.href = 'https://weapp.wemediacn.com/tnf/north/vipeak/to_auth_page?page_type=user_center';\n    },\n\n    // 拼图成功\n    puzzleSucceed() {\n        this.sendRequest({\n            path: 'recode_game.php',\n            method: 'POST',\n            data: {\n                id: this._id,\n                status: 1\n            }\n        }).then((value) => {\n            this.nextScene();\n        }, (error) => {\n            alert(error);\n        });\n    },\n\n    // 跳转下一个场景\n    nextScene() {\n        this._sceneIndex++;\n\n        this.scenes.map((obj) => {\n            obj.node.active = obj.type === this._sceneIndex;\n        });\n    },\n\n    // 跳转上一个场景\n    prevScene() {\n        this._sceneIndex--;\n\n        if (this._sceneIndex < 0) {\n            this._sceneIndex = 0;\n        }\n\n        this.scenes.map((obj) => {\n            obj.node.active = obj.type === this._sceneIndex;\n        });\n    },\n\n    // 按钮动画\n    aniBtn(btn) {\n        const action = cc.repeatForever(\n            cc.sequence(\n                cc.scaleTo(this._duration, 1.1, 1.1),\n                cc.scaleTo(this._duration, 1, 1)\n            )\n        );\n\n        this[btn].runAction(action);\n    },\n\n    sendRequest({\n        path = '',\n        method = 'GET',\n        data = {},\n        extraUrl = 'http://h5.yuncii.com/nf/interface/'\n    }) {\n        return new Promise((resolve, reject) => {\n            const xhr = cc.loader.getXMLHttpRequest();\n            let requestURL = extraUrl + path;\n            let params = null;\n\n            if (typeof data === 'object') {\n                params = Object.keys(data).map(function(key) {\n                    return encodeURIComponent(key) + '=' + encodeURIComponent(data[key]);\n                }).join('&');\n            }\n\n            xhr.timeout = 5000;\n\n            if (cc.sys.isNative) {\n                xhr.setRequestHeader(\"Accept-Encoding\", \"gzip,deflate\", \"text/html;charset=UTF-8\");\n            }\n\n            switch (method) {\n                case 'GET':\n                    if (params !== null) {\n                        requestURL += params;\n                    }\n\n                    xhr.open(method, requestURL, true);\n\n                    break;\n                case 'POST':\n                    xhr.open(method, requestURL, true);\n\n                    xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n                    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n\n                    break;\n            }\n\n            xhr.onload = () => {\n                if (xhr.status >= 200 && xhr.status < 300) {\n                    cc.log(\"http res(\" + xhr.responseText.length + \"):\" + xhr.responseText);\n\n                    return resolve(JSON.parse(xhr.responseText));\n                } else {\n                    reject(xhr.statusText);\n                }\n            };\n\n            xhr.onerror = () => {\n                reject(xhr.statusText);\n            };\n\n            xhr.send(params);\n        });\n    }\n});"]}