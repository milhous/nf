{"version":3,"sources":["../../../../assets/script/assets/script/choose.js"],"names":["cc","Class","extends","Component","properties","list","default","type","Node","swiper","btnPrev","btnNext","ctor","_duration","_index","_isSwiper","_isClick","onLoad","on","EventType","TOUCH_END","handlePrev","handleNext","TOUCH_START","handleStart","TOUCH_MOVE","handleMove","handleEnd","start","map","item","index","arr","x","y","opacity","action","sequence","delayTime","place","v2","spawn","moveTo","fadeIn","callFunc","length","runAction","evt","handleChoose","scheduleOnce","customEvent","Event","EventCustom","setUserData","msg","node","dispatchEvent","swiperPuzzle","offsetX","width","startLoc","getStartLocation","endLoc","getLocation","equals","span","sub","Math","abs"],"mappings":"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","file":"choose.js","sourceRoot":"../../../../assets/script","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        list: {\n            default: [],\n            type: [cc.Node]\n        },\n        swiper: {\n            default: null,\n            type: cc.Node\n        },\n        btnPrev: {\n            default: null,\n            type: cc.Node\n        },\n        btnNext: {\n            default: null,\n            type: cc.Node\n        }\n    },\n\n    ctor() {\n        // 动画时间\n        this._duration = .6;\n        // 当前索引值\n        this._index = 1;\n        // 是否可切换\n        this._isSwiper = false;\n        // 是否是点击\n        this._isClick = false;\n    },\n\n    onLoad() {\n        this.btnPrev.on(cc.Node.EventType.TOUCH_END, this.handlePrev, this);\n        this.btnNext.on(cc.Node.EventType.TOUCH_END, this.handleNext, this);\n\n        this.swiper.on(cc.Node.EventType.TOUCH_START, this.handleStart, this);\n        this.swiper.on(cc.Node.EventType.TOUCH_MOVE, this.handleMove, this);\n        this.swiper.on(cc.Node.EventType.TOUCH_END, this.handleEnd, this);\n    },\n\n    start() {\n        this.list.map((item, index, arr) => {\n            const x = item.x;\n            const y = item.y;\n\n            item.opacity = 0;\n\n            const action = cc.sequence(\n                cc.delayTime(this._duration * index),\n                cc.place(cc.v2(x - 50, y)),\n                cc.spawn(\n                    cc.moveTo(this._duration, cc.v2(x, y)),\n                    cc.fadeIn(this._duration)\n                ),\n                cc.place(cc.v2(x, y)),\n                cc.callFunc(() => {\n                    if (index === arr.length - 1) {\n                        this._isSwiper = true;\n                    }\n                }, this)\n            );\n\n            item.runAction(action);\n\n            item.on(cc.Node.EventType.TOUCH_END, (evt) => {\n                this.handleChoose(evt, index);\n            }, this);\n        });\n    },\n\n    // 选择图片\n    handleChoose(evt, index) {\n        this.scheduleOnce(() => {\n            if (!this._isSwiper || !this._isClick) {\n                return;\n            }\n\n            const customEvent = new cc.Event.EventCustom('choosePuzzle', true);\n\n            customEvent.setUserData({\n                msg: '选择图片',\n                index\n            });\n\n            this.node.dispatchEvent(customEvent);\n        }, 0.1);\n    },\n\n    // 上一页\n    handlePrev(evt) {\n        if (this._index === 0 || !this._isSwiper) {\n            return;\n        }\n\n        this._index--;\n\n        this.swiperPuzzle();\n    },\n\n    // 下一页\n    handleNext(evt) {\n        if (this._index === this.list.length - 1 || !this._isSwiper) {\n            return;\n        }\n\n        this._index++;\n\n        this.swiperPuzzle();\n    },\n\n    // 切换拼图\n    swiperPuzzle() {\n        const index = this.list.length - (4 - this._index);\n        const x = this.swiper.x;\n        const y = this.swiper.y;\n        const offsetX = this.swiper.width / 3;\n\n        this._isSwiper = false;\n\n        const action = cc.sequence(\n            cc.place(cc.v2(x, y)),\n            cc.moveTo(this._duration, cc.v2(offsetX * index, y)),\n            cc.place(cc.v2(offsetX * index, y)),\n            cc.callFunc(() => {\n                this._isSwiper = true;\n                this._isClick = true;\n            }, this)\n        );\n\n        this.swiper.runAction(action);\n    },\n\n    // 触摸开始\n    handleStart(evt) {\n        this._isClick = false;\n    },\n\n    // 触摸移动\n    handleMove(evt) {\n\n    },\n\n    // 触摸结束\n    handleEnd(evt) {\n        const startLoc = evt.getStartLocation();\n        const endLoc = evt.getLocation();\n\n        this._isClick = startLoc.equals(endLoc);\n\n        if (!this._isClick) {\n            const span = endLoc.sub(startLoc);\n\n            //认定为水平方向滑动\n            if (Math.abs(span.x) > Math.abs(span.y)) {\n                if (span.x > 30) { //向右\n                    this.handleNext(evt);\n                } else if (span.x < -30) { //向左\n                    this.handlePrev(evt);\n                }\n            }\n        }\n    }\n});"]}